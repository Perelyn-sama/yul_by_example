<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Calldata - Yul By Example</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="A beginner&#x27;s guide to basic Solidity implementations in inline Assembly.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../introduction/Introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../contents/Array.html"><strong aria-hidden="true">2.</strong> Array</a></li><li class="chapter-item expanded "><a href="../contents/Bitwise.html"><strong aria-hidden="true">3.</strong> Bitwise</a></li><li class="chapter-item expanded "><a href="../contents/Call.html"><strong aria-hidden="true">4.</strong> Call</a></li><li class="chapter-item expanded "><a href="../contents/Calldata.html" class="active"><strong aria-hidden="true">5.</strong> Calldata</a></li><li class="chapter-item expanded "><a href="../contents/Conditionals.html"><strong aria-hidden="true">6.</strong> Conditionals</a></li><li class="chapter-item expanded "><a href="../contents/Counter.html"><strong aria-hidden="true">7.</strong> Counter</a></li><li class="chapter-item expanded "><a href="../contents/Enums.html"><strong aria-hidden="true">8.</strong> Enums</a></li><li class="chapter-item expanded "><a href="../contents/Errors.html"><strong aria-hidden="true">9.</strong> Errors</a></li><li class="chapter-item expanded "><a href="../contents/EtherWallet.html"><strong aria-hidden="true">10.</strong> Ether Wallet</a></li><li class="chapter-item expanded "><a href="../contents/Events.html"><strong aria-hidden="true">11.</strong> Events</a></li><li class="chapter-item expanded "><a href="../contents/Fallback.html"><strong aria-hidden="true">12.</strong> Fallback</a></li><li class="chapter-item expanded "><a href="../contents/ForLoop.html"><strong aria-hidden="true">13.</strong> For Loop</a></li><li class="chapter-item expanded "><a href="../contents/Functions.html"><strong aria-hidden="true">14.</strong> Functions</a></li><li class="chapter-item expanded "><a href="../contents/Hash.html"><strong aria-hidden="true">15.</strong> Hash</a></li><li class="chapter-item expanded "><a href="../contents/HelloWorld.html"><strong aria-hidden="true">16.</strong> Hello World</a></li><li class="chapter-item expanded "><a href="../contents/IsContract.html"><strong aria-hidden="true">17.</strong> Is Contract</a></li><li class="chapter-item expanded "><a href="../contents/Mapping.html"><strong aria-hidden="true">18.</strong> Mapping</a></li><li class="chapter-item expanded "><a href="../contents/SafeOperations.html"><strong aria-hidden="true">19.</strong> Safe Operations</a></li><li class="chapter-item expanded "><a href="../contents/SendEther.html"><strong aria-hidden="true">20.</strong> Send Ether</a></li><li class="chapter-item expanded "><a href="../contents/SignarureVerification.html"><strong aria-hidden="true">21.</strong> Signature Verification</a></li><li class="chapter-item expanded "><a href="../contents/SimpleStorage.html"><strong aria-hidden="true">22.</strong> Simple Storage</a></li><li class="chapter-item expanded "><a href="../contents/Structs.html"><strong aria-hidden="true">23.</strong> Structs</a></li><li class="chapter-item expanded "><a href="../contents/Types.html"><strong aria-hidden="true">24.</strong> Types</a></li><li class="chapter-item expanded "><a href="../contents/Unchecked.html"><strong aria-hidden="true">25.</strong> Unchecked</a></li><li class="chapter-item expanded "><a href="../contents/YulERC20.html"><strong aria-hidden="true">26.</strong> Yul ERC20</a></li><li class="chapter-item expanded "><a href="../about/authors.html"><strong aria-hidden="true">27.</strong> Authors</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Yul By Example</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h2 id="calldata-encoding"><a class="header" href="#calldata-encoding">Calldata Encoding</a></h2>
<p><code>NOTE:</code> <code>m</code> =&gt; memory location, <code>c</code> =&gt; calldata location (which is still memory, but dedicated at the moment).</p>
<p>This file is used to elaborate how the arguments encoded in the src/Calldata.sol file have been encoded for all functions defined in the CallerContract contract.</p>
<h3 id="function-1"><a class="header" href="#function-1">Function 1:</a></h3>
<h4 id="calladd"><a class="header" href="#calladd"><code>callAdd</code></a></h4>
<h5 id="assume-num--7"><a class="header" href="#assume-num--7">Assume num = 7</a></h5>
<p>This calls the <code>add(uint256)</code> function with selector <code>0x1003e2d2</code>. The calldata arguments for the <code>add</code> function can fit into the <code>scratch space</code> i.e. first 64 bytes of memory, <code>0x00</code> to <code>0x5f</code>. So we can comfortably fill it between <code>0x00</code> and <code>0x5f</code>.</p>
<h6 id="encoding"><a class="header" href="#encoding">Encoding</a></h6>
<pre><code class="language-assembly">c : ----------- | m : 0x00 - 0x1f | 4 bytes, starting from 1f
=&gt; 0x000000000000000000000000000000000000000000000000000000001003e2d2
=&gt; Function Selector (This part of the memory is not included as a starting point in the calldata, but a place to store the selector of the function to call).

c : 0x00 - 0x1f | m : 0x20 - 0x3f | 32 bytes
=&gt; 0x0000000000000000000000000000000000000000000000000000000000000007
=&gt; Hex encoding of the number we want to pass as argument to the function selector.

Total: 36 bytes | 36 | 0x24
</code></pre>
<h3 id="function-2"><a class="header" href="#function-2">Function 2:</a></h3>
<h4 id="callmultiply"><a class="header" href="#callmultiply"><code>callMultiply</code></a></h4>
<h5 id="assume-num1--6-num2--7"><a class="header" href="#assume-num1--6-num2--7">Assume num1 = 6, num2 = 7</a></h5>
<p>This calls the <code>multiply(uint8,uint8)</code> function with selector <code>0x6a7a8e0b</code>. The data arguments we need will not be contained in the <code>scratch space</code> as they're <code>the selector</code>, <code>num1</code> and <code>num2</code>, all 32 bytes. We will need to encode them in the free memory, which starts from <code>0x80</code>. Also, despite us having <code>uint8</code> types which would mean <code>0xff</code>, the <code>ABI</code> demands we pass them as 32 bytes as well.</p>
<h6 id="encoding-1"><a class="header" href="#encoding-1">Encoding</a></h6>
<pre><code class="language-assembly">c : ----------- | m : 0x80 - 0x9f | 4 bytes, starting from 9f
=&gt; 0x000000000000000000000000000000000000000000000000000000006a7a8e0b

c : 0x00 - 0x1f | m : 0xa0 - 0xbf | 32 bytes
=&gt; 0x0000000000000000000000000000000000000000000000000000000000000006
=&gt; Hex encoding of the first argument to the function selector.

c : 0x20 - 0x3f | m : 0xc0 - 0xdf | 32 bytes
=&gt; 0x0000000000000000000000000000000000000000000000000000000000000007
=&gt; Hex encoding of the second argument to the function selector.

Total: 68 bytes | 68 | 0x44
</code></pre>
<h3 id="function-3"><a class="header" href="#function-3">Function 3</a></h3>
<h4 id="callarraysum"><a class="header" href="#callarraysum"><code>callArraySum</code></a></h4>
<h5 id="assume-num1--1-num2--2-num3--3-num4--4"><a class="header" href="#assume-num1--1-num2--2-num3--3-num4--4">Assume num1 = 1, num2 = 2, num3 = 3, num4 = 4</a></h5>
<p>This calls the <code>arraySum(uint256[])</code> function with selector <code>0x7c2b11cd</code> with 4 array values.</p>
<h6 id="encoding-2"><a class="header" href="#encoding-2">Encoding</a></h6>
<pre><code class="language-assembly">c : -----------     | m : 0x80 - 0x9f       | 4 bytes, starting from 9f
=&gt; 0x000000000000000000000000000000000000000000000000000000007c2b11cd

c : 0x00 - 0x1f     | m : 0xa0 - 0xbf       | 32 bytes
=&gt; 0x0000000000000000000000000000000000000000000000000000000000000020
=&gt; Array pointer (points to 0x20 in calldata, the length of the array is stored there).

c : 0x20 - 0x3f     | m : 0xc0 - 0xdf       | 32 bytes
=&gt; 0x0000000000000000000000000000000000000000000000000000000000000004
=&gt; Length of array.

c : 0x40 - 0x5f     | m : 0xe0 - 0xff       | 32 bytes
=&gt; 0x0000000000000000000000000000000000000000000000000000000000000001
=&gt; First number, 1.

c : 0x60 - 0x7f     | m : 0x0100 - 0x011f   | 32 bytes
=&gt; 0x0000000000000000000000000000000000000000000000000000000000000002
=&gt; Second number, 2.

c : 0x80 - 0x9f     | m : 0x0120 - 0x013f   | 32 bytes
=&gt; 0x0000000000000000000000000000000000000000000000000000000000000003
=&gt; Third number, 3.

c : 0x0xa0 - 0xbf   | m : 0x0140 - 0x015f   | 32 bytes
=&gt; 0x0000000000000000000000000000000000000000000000000000000000000004
=&gt; Fourth number, 1.

Total: 196 bytes | 196 | 0xc4
</code></pre>
<h3 id="function-4"><a class="header" href="#function-4">Function 4</a></h3>
<h4 id="callsetstring"><a class="header" href="#callsetstring"><code>callSetString</code></a></h4>
<h5 id="assume-str--hello"><a class="header" href="#assume-str--hello">Assume str = "Hello"</a></h5>
<p>This calls the <code>setString(string)</code> function with selector <code>0x7fcaf666</code> with 4 array values. However, this might get tricky. Since the memory can only contain one 32 bytes value at a time, we might make some impositions that will restrict the set string to 32 characters. However, since we want to set a storage string in the <code>CalledContract</code>, the max a storage string can take is 31 bytes, so we will restrict our function to only take in 31 bytes.
These first two lines will handle that for us. Having strings with len &gt; 31</p>
<pre><code class="language-solidity">function callSetString(string calldata str) public {
    uint8 len = uint8(bytes(str).length);
    if (len &gt; 31) revert();
    _;
}
</code></pre>
<p><code>NOTE</code>: Whenever a memory reference is passed inside a function, it advances the free memory pointer by 64 bytes. Memory references includes:
<code>abi.encode()</code>,
<code>abi.encodePacked()</code>,
<code>bytes memory</code>,
<code>string memory</code>,
<code>bytes constant</code> (Storage variable, this will advance the pointer by 128 bytes because the value will be substituted and read again).</p>
<p>It is advised to <code>ALWAYS</code> use <code>mload(0x40)</code> to write to the next slot then update to avoid accidental overwrites.</p>
<h6 id="encoding-3"><a class="header" href="#encoding-3">Encoding</a></h6>
<pre><code class="language-solidity">function callSetString(string calldata str) public {
    _;
    bytes memory strCopy = bytes(str);
    _;
}
</code></pre>
<p>This moves the memory by 64 bytes, which we will store at a random location we know won't be overwritten until the function call is over <code>0x0200</code>.</p>
<pre><code class="language-assembly">c : -----------     | m : 0x80 - 0x9f       | 4 bytes, starting from 9f
=&gt; 0x000000000000000000000000000000000000000000000000000000007fcaf666

c : 0x00 - 0x1f     | m : 0xa0 - 0xbf       | 32 bytes
=&gt; 0x0000000000000000000000000000000000000000000000000000000000000020
=&gt; String pointer (points to 0x20 in calldata, the length of the string is stored there).

c : 0x20 - 0x3f     | m : 0xc0 - 0xdf       | 32 bytes
=&gt; 0x0000000000000000000000000000000000000000000000000000000000000005
=&gt; Length of string "Hello".

c : 0x40 - 0x5f     | m : 0xe0 - 0xff       | 32 bytes
=&gt; 0x48656c6c6f000000000000000000000000000000000000000000000000000000
=&gt; String Hello in bytes.

Total: 100 bytes | 100 | 0x64
</code></pre>
<p><code>PS:</code> FIXED AND DYNAMIC BYTE ARRAYS ARE LEFT ALIGNED, EVERYTHING ELSE IS RIGHT ALIGNED.</p>
<h3 id="function-5"><a class="header" href="#function-5">Function 5</a></h3>
<h4 id="callstructcall"><a class="header" href="#callstructcall"><code>callStructCall</code></a></h4>
<h5 id="assume-num1--6-num2--7-1"><a class="header" href="#assume-num1--6-num2--7-1">Assume num1 = 6, num2 = 7</a></h5>
<p>The encoding is similar to the <code>callMultiply</code>.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../contents/Call.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../contents/Conditionals.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../contents/Call.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../contents/Conditionals.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script>
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
