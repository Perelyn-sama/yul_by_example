<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Yul By Example</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->
        
        <meta name="description" content="A beginner&#x27;s guide to basic Solidity implementations in inline Assembly.">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="introduction/Introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="contents/Array.html"><strong aria-hidden="true">2.</strong> Array</a></li><li class="chapter-item expanded "><a href="contents/Bitwise.html"><strong aria-hidden="true">3.</strong> Bitwise</a></li><li class="chapter-item expanded "><a href="contents/Call.html"><strong aria-hidden="true">4.</strong> Call</a></li><li class="chapter-item expanded "><a href="contents/Calldata.html"><strong aria-hidden="true">5.</strong> Calldata</a></li><li class="chapter-item expanded "><a href="contents/Conditionals.html"><strong aria-hidden="true">6.</strong> Conditionals</a></li><li class="chapter-item expanded "><a href="contents/Counter.html"><strong aria-hidden="true">7.</strong> Counter</a></li><li class="chapter-item expanded "><a href="contents/Enums.html"><strong aria-hidden="true">8.</strong> Enums</a></li><li class="chapter-item expanded "><a href="contents/Errors.html"><strong aria-hidden="true">9.</strong> Errors</a></li><li class="chapter-item expanded "><a href="contents/EtherWallet.html"><strong aria-hidden="true">10.</strong> Ether Wallet</a></li><li class="chapter-item expanded "><a href="contents/Events.html"><strong aria-hidden="true">11.</strong> Events</a></li><li class="chapter-item expanded "><a href="contents/Fallback.html"><strong aria-hidden="true">12.</strong> Fallback</a></li><li class="chapter-item expanded "><a href="contents/ForLoop.html"><strong aria-hidden="true">13.</strong> For Loop</a></li><li class="chapter-item expanded "><a href="contents/Functions.html"><strong aria-hidden="true">14.</strong> Functions</a></li><li class="chapter-item expanded "><a href="contents/Hash.html"><strong aria-hidden="true">15.</strong> Hash</a></li><li class="chapter-item expanded "><a href="contents/HelloWorld.html"><strong aria-hidden="true">16.</strong> Hello World</a></li><li class="chapter-item expanded "><a href="contents/IsContract.html"><strong aria-hidden="true">17.</strong> Is Contract</a></li><li class="chapter-item expanded "><a href="contents/Mapping.html"><strong aria-hidden="true">18.</strong> Mapping</a></li><li class="chapter-item expanded "><a href="contents/SafeOperations.html"><strong aria-hidden="true">19.</strong> Safe Operations</a></li><li class="chapter-item expanded "><a href="contents/SendEther.html"><strong aria-hidden="true">20.</strong> Send Ether</a></li><li class="chapter-item expanded "><a href="contents/SignarureVerification.html"><strong aria-hidden="true">21.</strong> Signature Verification</a></li><li class="chapter-item expanded "><a href="contents/SimpleStorage.html"><strong aria-hidden="true">22.</strong> Simple Storage</a></li><li class="chapter-item expanded "><a href="contents/Structs.html"><strong aria-hidden="true">23.</strong> Structs</a></li><li class="chapter-item expanded "><a href="contents/Types.html"><strong aria-hidden="true">24.</strong> Types</a></li><li class="chapter-item expanded "><a href="contents/Unchecked.html"><strong aria-hidden="true">25.</strong> Unchecked</a></li><li class="chapter-item expanded "><a href="contents/YulERC20.html"><strong aria-hidden="true">26.</strong> Yul ERC20</a></li><li class="chapter-item expanded "><a href="about/authors.html"><strong aria-hidden="true">27.</strong> Authors</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Yul By Example</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="array"><a class="header" href="#array">Array</a></h1>
<pre><code class="language-solidity">contract Array {
    uint8[3] public fixedU8Array;
    uint8[] public dynamicU8Array;
    
    uint256[3] public fixedU256Array;
    uint256[] public dynamicU256Array;
}

/*
*   Array Variable    |   Slot(s) Occupied    |   Values Stored At Slot(s) [sload(slot)]
*   __________________|_______________________|_____________________________________________________
*   fixedU8Array      |   0 - 2               |   0 &lt;= x &lt;= 2 
*   dynamicU8Array    |   3                   |   keccak256(3) + (0 &lt;= x &lt; dynamicU8Array.length)
*   fixedU256Array    |   4 - 6               |   4 &lt;= x &lt;= 6
*   dynamicU256Array  |   7                   |   keccak256(7) + (0 &lt;= x &lt; dynamicU256Array.length)
*   __________________|_______________________|_____________________________________________________
*/
</code></pre>
<h2 id="array-storage"><a class="header" href="#array-storage">Array Storage</a></h2>
<p>Arrays in Yul take up slots depending on their array type. Array types include:</p>
<ul>
<li>Fixed Array, i.e. <code>fixedU256Array</code></li>
<li>Dynamic Array, i.e. <code>dynamicU256Array</code></li>
</ul>
<p>Because the length of a fixed arrays are known, they take up slots as much as their length. i.e. <code>fixedU256Array</code> is of length <code>3</code>, therefore, it will take up 3 slots starting from its current slot. However, slot taking of a fixed array is also controlled by its data type, uint256 will take up an entire slot. So there will be as many slots occupied as 3 <code>uint256</code> numbers in the <code>fixedU256Array</code>.</p>
<p>In the case of <code>fixedU8Array</code>, which has a known length of 3, because it's of type <code>uint8</code>, it will be packed in that slot where it should start from.</p>
<p>Dynamic arrays are different, because, their lengths are not known, so there is no set amount of slots allocated for it, therefore, at their slots, which we will call <code>slot</code>, the length of the array is stored. Then the array elements can be found starting at slot <code>keccak256(slot)</code> and spanning up till <code>keccak256(slot)</code> + ((the length of the array) - 1).</p>
<p>If dynamicU256Array should have 5 elements, at its slot in storage, which we will assume as <code>c</code>, the value <code>5</code> will be stored. Then to get these 5 elements, they will be found at:<br><br>
Index 0 =&gt; <code>keccak256(c) + 0</code><br>
Index 1 =&gt; <code>keccak256(c) + 1</code><br>
Index 2 =&gt; <code>keccak256(c) + 2</code><br>
Index 3 =&gt; <code>keccak256(c) + 3</code><br>
Index 4 =&gt; <code>keccak256(c) + 4</code><br><br>
All 5 elements. Adding one element to the array will increment the value at slot <code>c</code> to <code>6</code> and also add an:<br><br>
Index 5 =&gt; <code>keccak256(c) + 5</code><br><br>
Which is the <code>6th</code> element.</p>
<h2 id="reading-from-an-array"><a class="header" href="#reading-from-an-array">Reading From An Array</a></h2>
<p>While reading the elements of the <code>fixedU256Array</code> is simple, because, type <code>uint256</code> takes up 32 bytes, the same cannot be said for the <code>fixexU8Array</code> as they're packed and care would be taken to avoid messing up the value stored at that slot. We can always call an <code>sload(slot)</code> to get the value of any index stored at any slot.</p>
<p>However, for <code>fixedU8Array</code> on initialization:</p>
<pre><code class="language-solidity">contract Array {
    uint8[3] public fixedU8Array;

    constructor() {
        // Initialize array variables.
        fixedU8Array = [1, 2, 3];
    }
}
</code></pre>
<p>Once the slot where the values of the <code>fixedU8Array</code> has been located, which we shall address as <code>loc</code>, we can call a simple <code>sload(loc)</code> to get the value stored at that slot, which will be returned as:</p>
<pre><code class="language-solidity">0x0000000000000000000000000000000000000000000000000000000000030201
</code></pre>
<p>It will be packed, as stated earlier. We can then use a masking to return any index in the array based of the <code>uint8</code> type, <code>1 byte</code> by calculating its offset precisely.</p>
<h3 id="more-info"><a class="header" href="#more-info">More Info</a></h3>
<p><a href="https://rb.gy/yvbfwf">Click to read more.</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="bitwise"><a class="header" href="#bitwise">Bitwise</a></h1>
<h2 id="what-are-bitwise-operations"><a class="header" href="#what-are-bitwise-operations">What Are Bitwise Operations?</a></h2>
<p><a href="https://rb.gy/gxiku">Understanding Bitwise Operators</a></p>
<h3 id="bitwise-operators"><a class="header" href="#bitwise-operators">Bitwise Operators:</a></h3>
<pre><code>    Name        |   Symbol      
________________|___________
    AND         |   &amp;   
    LEFT SHIFT  |   &lt;&lt;
    NOT         |   ~    
    OR          |   |
    RIGHT SHIFT |   &gt;&gt;
    XOR         |   ^           
</code></pre>
<h2 id="more-info-1"><a class="header" href="#more-info-1">More Info</a></h2>
<p><a href="https://rb.gy/gxiku">Understanding Bitwise Operators</a>
<a href="https://rb.gy/gzjxq">Bitwise Operators Wiki</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="call"><a class="header" href="#call">Call</a></h1>
<p>Calldata encoding: https://rb.gy/vmzhck. <br></p>
<p>The callContract function in the CallerContract contract calls the setNumber function in the CalledContract contract via a call opcode. This opcode takes in 7 arguments:
<code>gas</code><br>
<code>address</code><br>
<code>value</code><br>
<code>dataOffset</code><br>
<code>dataSize</code><br>
<code>returnDataOffset</code><br>
<code>returnDataSize</code><br></p>
<h3 id="gas"><a class="header" href="#gas"><code>gas</code></a></h3>
<p>Amount of gas to send in <code>call</code>, usually set to <code>gas()</code> or any specified number, <code>n</code>.</p>
<h3 id="address"><a class="header" href="#address"><code>address</code></a></h3>
<p>Address to make <code>call</code> to. If the address does not have a function that matches the identifier, the <code>fallback</code> function is called. If it doesn't have one, it returns <code>false</code>.</p>
<p><code>NOTE</code>: <code>Call</code>s made to invalid addresses return true, <code>call</code> returns false on two occassions:</p>
<ol>
<li>The address has no <code>fallback</code> function.</li>
<li>The function called reverts.</li>
</ol>
<h3 id="value"><a class="header" href="#value"><code>value</code></a></h3>
<p>Amount in ETH to be sent.</p>
<h3 id="dataoffset-and-datasize"><a class="header" href="#dataoffset-and-datasize"><code>dataOffset</code> and <code>dataSize</code></a></h3>
<p>The <code>dataOffset</code> and <code>dataSize</code> are determined by the size of the encoded calldata sent to the <code>adderss</code>.</p>
<p>First, we store the function selector, <code>3fb5c1cb</code>, which we already have as a literal in location <code>0x00</code>, setting location <code>0x00</code> to <code>0x1f</code> to:</p>
<pre><code class="language-assembly">0x000000000000000000000000000000000000000000000000000000003fb5c1cb
</code></pre>
<p>NOTE: If we store the selector in a variable:</p>
<pre><code class="language-solidity">bytes4 selector = 0x3fb5c1cb;
</code></pre>
<p>and then save it to location 0x00, we will have:</p>
<pre><code class="language-assembly">0x3fb5c1cb00000000000000000000000000000000000000000000000000000000
</code></pre>
<p><code>PS:</code> FIXED AND DYNAMIC BYTE ARRAYS ARE LEFT ALIGNED, EVERYTHING ELSE IS RIGHT ALIGNED.<br></p>
<p>We can then encode the number we want to pass, takes as <code>4</code>, in the next location <code>0x20</code> - <code>0x3f</code>, leaving us with:</p>
<pre><code class="language-assembly">0x0000000000000000000000000000000000000000000000000000000000000004
</code></pre>
<p>In location <code>0x20</code> - <code>0x3f</code>. We can then calculate the offset and size of bytes we want to pass through in our <code>call</code> opcode by observing the location of <code>3f</code> in location <code>0x00</code> - <code>0x1f</code>, getting the size in bytes from that point to <code>0x1f</code>, and then adding it to <code>32</code> bytes, which is the size of the data stored in location <code>0x20</code> - <code>0x3f</code>.</p>
<p>The location of <code>3f</code> is <code>0x1c</code>, our <code>dataOffset</code>.</p>
<p>This will leave us with <code>0x1c</code> to <code>0x1f</code>, which is 4 bytes, and <code>0x20</code> - <code>0x3f</code> which is 32 bytes. 32 bytes + 4 bytes = <code>36 bytes</code>, our data size.</p>
<pre><code class="language-assembly">let success := call(gas(), _called, 0, 0x1c, 0x24, 0, 0)
// 0x1c == Offset.
// 0x24 == 36 bytes.
</code></pre>
<h3 id="returndataoffset-and-returndatasize"><a class="header" href="#returndataoffset-and-returndatasize"><code>returnDataOffset</code> and <code>returnDataSize</code></a></h3>
<p>Specifies the offset and size of the data returned from the call to copy to memory. The returnDataSize is obtained via the <code>returndatasize()</code> opcode in Yul. The offset is any offset specified by the developer to match his desired returned value. If there is no returned data or the returned data is not needed, <code>0x00</code> or <code>0</code> can be passed for both cases.</p>
<pre><code class="language-assembly">let success := call(gas(), _called, 0, 0x1c, 0x24, 0, 0)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h2 id="calldata-encoding"><a class="header" href="#calldata-encoding">Calldata Encoding</a></h2>
<p><code>NOTE:</code> <code>m</code> =&gt; memory location, <code>c</code> =&gt; calldata location (which is still memory, but dedicated at the moment).</p>
<p>This file is used to elaborate how the arguments encoded in the src/Calldata.sol file have been encoded for all functions defined in the CallerContract contract.</p>
<h3 id="function-1"><a class="header" href="#function-1">Function 1:</a></h3>
<h4 id="calladd"><a class="header" href="#calladd"><code>callAdd</code></a></h4>
<h5 id="assume-num--7"><a class="header" href="#assume-num--7">Assume num = 7</a></h5>
<p>This calls the <code>add(uint256)</code> function with selector <code>0x1003e2d2</code>. The calldata arguments for the <code>add</code> function can fit into the <code>scratch space</code> i.e. first 64 bytes of memory, <code>0x00</code> to <code>0x5f</code>. So we can comfortably fill it between <code>0x00</code> and <code>0x5f</code>.</p>
<h6 id="encoding"><a class="header" href="#encoding">Encoding</a></h6>
<pre><code class="language-assembly">c : ----------- | m : 0x00 - 0x1f | 4 bytes, starting from 1f
=&gt; 0x000000000000000000000000000000000000000000000000000000001003e2d2
=&gt; Function Selector (This part of the memory is not included as a starting point in the calldata, but a place to store the selector of the function to call).

c : 0x00 - 0x1f | m : 0x20 - 0x3f | 32 bytes
=&gt; 0x0000000000000000000000000000000000000000000000000000000000000007
=&gt; Hex encoding of the number we want to pass as argument to the function selector.

Total: 36 bytes | 36 | 0x24
</code></pre>
<h3 id="function-2"><a class="header" href="#function-2">Function 2:</a></h3>
<h4 id="callmultiply"><a class="header" href="#callmultiply"><code>callMultiply</code></a></h4>
<h5 id="assume-num1--6-num2--7"><a class="header" href="#assume-num1--6-num2--7">Assume num1 = 6, num2 = 7</a></h5>
<p>This calls the <code>multiply(uint8,uint8)</code> function with selector <code>0x6a7a8e0b</code>. The data arguments we need will not be contained in the <code>scratch space</code> as they're <code>the selector</code>, <code>num1</code> and <code>num2</code>, all 32 bytes. We will need to encode them in the free memory, which starts from <code>0x80</code>. Also, despite us having <code>uint8</code> types which would mean <code>0xff</code>, the <code>ABI</code> demands we pass them as 32 bytes as well.</p>
<h6 id="encoding-1"><a class="header" href="#encoding-1">Encoding</a></h6>
<pre><code class="language-assembly">c : ----------- | m : 0x80 - 0x9f | 4 bytes, starting from 9f
=&gt; 0x000000000000000000000000000000000000000000000000000000006a7a8e0b

c : 0x00 - 0x1f | m : 0xa0 - 0xbf | 32 bytes
=&gt; 0x0000000000000000000000000000000000000000000000000000000000000006
=&gt; Hex encoding of the first argument to the function selector.

c : 0x20 - 0x3f | m : 0xc0 - 0xdf | 32 bytes
=&gt; 0x0000000000000000000000000000000000000000000000000000000000000007
=&gt; Hex encoding of the second argument to the function selector.

Total: 68 bytes | 68 | 0x44
</code></pre>
<h3 id="function-3"><a class="header" href="#function-3">Function 3</a></h3>
<h4 id="callarraysum"><a class="header" href="#callarraysum"><code>callArraySum</code></a></h4>
<h5 id="assume-num1--1-num2--2-num3--3-num4--4"><a class="header" href="#assume-num1--1-num2--2-num3--3-num4--4">Assume num1 = 1, num2 = 2, num3 = 3, num4 = 4</a></h5>
<p>This calls the <code>arraySum(uint256[])</code> function with selector <code>0x7c2b11cd</code> with 4 array values.</p>
<h6 id="encoding-2"><a class="header" href="#encoding-2">Encoding</a></h6>
<pre><code class="language-assembly">c : -----------     | m : 0x80 - 0x9f       | 4 bytes, starting from 9f
=&gt; 0x000000000000000000000000000000000000000000000000000000007c2b11cd

c : 0x00 - 0x1f     | m : 0xa0 - 0xbf       | 32 bytes
=&gt; 0x0000000000000000000000000000000000000000000000000000000000000020
=&gt; Array pointer (points to 0x20 in calldata, the length of the array is stored there).

c : 0x20 - 0x3f     | m : 0xc0 - 0xdf       | 32 bytes
=&gt; 0x0000000000000000000000000000000000000000000000000000000000000004
=&gt; Length of array.

c : 0x40 - 0x5f     | m : 0xe0 - 0xff       | 32 bytes
=&gt; 0x0000000000000000000000000000000000000000000000000000000000000001
=&gt; First number, 1.

c : 0x60 - 0x7f     | m : 0x0100 - 0x011f   | 32 bytes
=&gt; 0x0000000000000000000000000000000000000000000000000000000000000002
=&gt; Second number, 2.

c : 0x80 - 0x9f     | m : 0x0120 - 0x013f   | 32 bytes
=&gt; 0x0000000000000000000000000000000000000000000000000000000000000003
=&gt; Third number, 3.

c : 0x0xa0 - 0xbf   | m : 0x0140 - 0x015f   | 32 bytes
=&gt; 0x0000000000000000000000000000000000000000000000000000000000000004
=&gt; Fourth number, 1.

Total: 196 bytes | 196 | 0xc4
</code></pre>
<h3 id="function-4"><a class="header" href="#function-4">Function 4</a></h3>
<h4 id="callsetstring"><a class="header" href="#callsetstring"><code>callSetString</code></a></h4>
<h5 id="assume-str--hello"><a class="header" href="#assume-str--hello">Assume str = "Hello"</a></h5>
<p>This calls the <code>setString(string)</code> function with selector <code>0x7fcaf666</code> with 4 array values. However, this might get tricky. Since the memory can only contain one 32 bytes value at a time, we might make some impositions that will restrict the set string to 32 characters. However, since we want to set a storage string in the <code>CalledContract</code>, the max a storage string can take is 31 bytes, so we will restrict our function to only take in 31 bytes.
These first two lines will handle that for us. Having strings with len &gt; 31</p>
<pre><code class="language-solidity">function callSetString(string calldata str) public {
    uint8 len = uint8(bytes(str).length);
    if (len &gt; 31) revert();
    _;
}
</code></pre>
<p><code>NOTE</code>: Whenever a memory reference is passed inside a function, it advances the free memory pointer by 64 bytes. Memory references includes:
<code>abi.encode()</code>,
<code>abi.encodePacked()</code>,
<code>bytes memory</code>,
<code>string memory</code>,
<code>bytes constant</code> (Storage variable, this will advance the pointer by 128 bytes because the value will be substituted and read again).</p>
<p>It is advised to <code>ALWAYS</code> use <code>mload(0x40)</code> to write to the next slot then update to avoid accidental overwrites.</p>
<h6 id="encoding-3"><a class="header" href="#encoding-3">Encoding</a></h6>
<pre><code class="language-solidity">function callSetString(string calldata str) public {
    _;
    bytes memory strCopy = bytes(str);
    _;
}
</code></pre>
<p>This moves the memory by 64 bytes, which we will store at a random location we know won't be overwritten until the function call is over <code>0x0200</code>.</p>
<pre><code class="language-assembly">c : -----------     | m : 0x80 - 0x9f       | 4 bytes, starting from 9f
=&gt; 0x000000000000000000000000000000000000000000000000000000007fcaf666

c : 0x00 - 0x1f     | m : 0xa0 - 0xbf       | 32 bytes
=&gt; 0x0000000000000000000000000000000000000000000000000000000000000020
=&gt; String pointer (points to 0x20 in calldata, the length of the string is stored there).

c : 0x20 - 0x3f     | m : 0xc0 - 0xdf       | 32 bytes
=&gt; 0x0000000000000000000000000000000000000000000000000000000000000005
=&gt; Length of string "Hello".

c : 0x40 - 0x5f     | m : 0xe0 - 0xff       | 32 bytes
=&gt; 0x48656c6c6f000000000000000000000000000000000000000000000000000000
=&gt; String Hello in bytes.

Total: 100 bytes | 100 | 0x64
</code></pre>
<p><code>PS:</code> FIXED AND DYNAMIC BYTE ARRAYS ARE LEFT ALIGNED, EVERYTHING ELSE IS RIGHT ALIGNED.</p>
<h3 id="function-5"><a class="header" href="#function-5">Function 5</a></h3>
<h4 id="callstructcall"><a class="header" href="#callstructcall"><code>callStructCall</code></a></h4>
<h5 id="assume-num1--6-num2--7-1"><a class="header" href="#assume-num1--6-num2--7-1">Assume num1 = 6, num2 = 7</a></h5>
<p>The encoding is similar to the <code>callMultiply</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="conditionals"><a class="header" href="#conditionals">Conditionals</a></h1>
<p>There are no parentheses in the if statements, and there are no elses, rather, use switch.</p>
<p><code>0</code> =&gt; <code>False</code><br>
<code>1</code> =&gt; <code>True</code></p>
<h3 id="if"><a class="header" href="#if">If</a></h3>
<pre><code class="language-assembly">if lt(x, 10) { res := 0 }
if gt(x, 10) { res := 1 }
</code></pre>
<h3 id="switch"><a class="header" href="#switch">Switch</a></h3>
<pre><code class="language-assembly">switch lt(x, 79)
case 1 { isTrue := 0x01 }
default { isTrue := 0x00 }
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="counter"><a class="header" href="#counter">Counter</a></h1>
<p>Study: https://rb.gy/3wj60</p>
<p>Yul does not have any checks for over and underflow, therefore, whenever the <code>inc()</code> is called, the function asserts that the current number is not equal to the max of uint256,</p>
<pre><code class="language-assembly">0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff
</code></pre>
<p>And then, increments it by one.</p>
<p>Also, calling the <code>dec()</code> will assert that the current value is not equal to <code>0</code>, and then, decrements it by one.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="enums"><a class="header" href="#enums">Enums</a></h1>
<p><code>enum</code>s are treated as <code>uint8</code>, hence, packed.</p>
<pre><code class="language-solidity">myEnum myenum = myEnum.STOPPED;
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="errors"><a class="header" href="#errors">Errors</a></h1>
<p>Errors are encoded the same way a calldata is encoded. First their 4 byte selector, then their arguments. And are read starting from the start of the selector with a size as large at their selector + encoded arguments.</p>
<pre><code class="language-assembly">if lt(errorNumber, mainNumber) {
    mstore(0x00, errorSelector) // 4 bytes.
    mstore(0x04, storedNumberForError) // 32 bytes.
    revert(0x00, 0x24) // Reads 36 bytes.
}
</code></pre>
<p>Errors that do not want to return data simply revert with <code>(0x00, 0x00)</code>.</p>
<pre><code class="language-assembly">if lt(errorNumber, mainNumber) {
    revert(0x00, 0x00)
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="etherwallet"><a class="header" href="#etherwallet">EtherWallet</a></h1>
<h3 id="on-deployment"><a class="header" href="#on-deployment">On Deployment</a></h3>
<p><code>constructor</code> is marked <code>payable</code>, and will accept payments &gt;= 0 ETH to deploy contract. In this case, it retrieves the address of <code>msg.sender</code> from the <code>caller()</code> opcode and saves it in slot <code>0</code> (the <code>owner</code> variable). <code>receive()</code> allows ETH sent from external sources.</p>
<h3 id="getbalance"><a class="header" href="#getbalance">getBalance()</a></h3>
<p>To get the balance of the contract, there are two ways to go about that:</p>
<ol>
<li>
<p><code>balance(address())</code>
<code>address()</code> returns the address of the contract in execution, <code>address(this)</code>. <code>balance(address _address)</code> returns the balance of ETH at <code>_address</code>.</p>
</li>
<li>
<p><code>selfbalance()</code>
This is an easier way to get the balance of the executing contract.</p>
</li>
</ol>
<h3 id="withdraw"><a class="header" href="#withdraw">withdraw()</a></h3>
<p>It evaluates that <code>caller()</code> is the owner of the contract by comparing the value of <code>caller()</code> with the value stored at slot <code>0</code>. If they match, the <code>_amount</code> passed is withdrawn via <code>call</code>. If they don't, it stores the <code>UnauthorizedSelector</code> at location <code>0x00</code>, and reverts, returning the first 4 bytes of the error selector.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="events"><a class="header" href="#events">Events</a></h1>
<p>Events are emitted through the <code>log()</code> opcode which can allow up to <code>4</code> indexed events (for <code>anonymous events</code>) and <code>3</code> indexed events (for <code>non-anonymous events</code>). They range from <code>log0</code> to <code>log4</code> with each having a default <code>offset</code> and <code>size</code> as their first two parameters. This <code>offset</code> and <code>size</code> is the start and size of the <code>ABI encoded data</code> of the event's <code>unindexed</code> arguments. If there are no <code>unindexed</code> values, then <code>0x00</code> is stored for both <code>offset</code> and <code>size</code>.</p>
<p>Refer to https://rb.gy/bf8b1.</p>
<p>If the event is a <code>non-anonymous event</code>, the first topic, <code>topic[0]</code> is the <code>event signature</code>, then the subsequent topics, <code>topic[1]</code> - <code>topic[3]</code> are the indexed values of that event.</p>
<p>If the event is an <code>anonymous event</code>, there is no <code>event signature</code> stored, just the indexed event values.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="fallback"><a class="header" href="#fallback">Fallback</a></h1>
<p>This is a function called when the <code>function selector</code> sent as a transaction to the contract doesn't match any function in that contract.</p>
<p>It is specified with a:</p>
<pre><code class="language-solidity">fallback() external {}
</code></pre>
<p>OR</p>
<pre><code class="language-solidity">fallback() external payable {}
</code></pre>
<p>In our <a href="https://github.com/Perelyn-sama/yul_by_example/blob/main/src/Fallback.sol">Fallback</a> contract, it sends <code>1 Wei</code> to any caller.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="forloop"><a class="header" href="#forloop">ForLoop</a></h1>
<p>In Yul, there is only a <code>for</code> loop, and no <code>while</code> loop, however, we can rewrite a <code>for</code> loop to match a <code>while</code> loop.</p>
<pre><code class="language-assembly">for { let i := 0 } lt(i, 10) { i := add(i, 1) }
</code></pre>
<p>Is the Yul way of writing:</p>
<pre><code class="language-javascript">for (i = 0; i &lt; 10; i++)
</code></pre>
<h3 id="while-loop-imitation"><a class="header" href="#while-loop-imitation">While Loop Imitation</a></h3>
<p>Source: http://rb.gy/4narf.</p>
<pre><code class="language-assembly">assembly {
    let x := 0
    let i := 0
    for { } lt(i, 0x100) { } {   // while(i &lt; 256), 100 (hex) = 256
        x := add(x, mload(i))
        i := add(i, 0x20)
    }
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="functions"><a class="header" href="#functions">Functions</a></h1>
<p>Yul can have functions in them, and these functions can return values as well.</p>
<h4 id="a-simple-sum-function-without-return-value"><a class="header" href="#a-simple-sum-function-without-return-value">A Simple Sum Function Without Return Value</a></h4>
<p>This function will take two numbers, add them, and then store the sum in location <code>0x00</code>.</p>
<pre><code class="language-assembly">assembly {
    function sum(num1, num2) {
        mstore(0x00, add(num1, num2))
    }
    sum(a, b)
}
</code></pre>
<h4 id="a-simple-sum-function-with-return-value"><a class="header" href="#a-simple-sum-function-with-return-value">A Simple Sum Function With Return Value</a></h4>
<p>This function will take two numbers, add them, return the value as <code>total</code> and then store it in location <code>0x00</code>.</p>
<pre><code class="language-assembly">assembly {
    function sum(num1, num2) -&gt; total {
        total := add(num1, num2)
    }
    mstore(0x00, sum(a, b))
}
</code></pre>
<p><code>PS</code>: <strong>BEWARE OF OVER AND UNDERFLOWS!!!</strong></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="hash"><a class="header" href="#hash">Hash</a></h1>
<p>Study http://rb.gy/8bqae.</p>
<pre><code class="language-assembly">49206f64206e746f20657078746563206f736d6f6e6565206f6877206574646e6f732065646e726e7561737464204941422063696e676e64656f206f7420746765207368746920697463706f2e
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="hello-world"><a class="header" href="#hello-world">Hello World!</a></h1>
<p>Source: http://rb.gy/j97db.</p>
<p>A simple Yul "Hello World!" code.</p>
<p>Returned string is <code>ABI Encoded</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="iscontract"><a class="header" href="#iscontract">IsContract</a></h1>
<p>This checks if an <code>address</code> is a contract or an <code>EOA</code> by looking at the size of the code. <code>EOA</code>s do not have code, <code>contracts</code> have code. The <code>extcodesize()</code> opcode returns the size of this code which is <code>0</code> for <code>EOA</code>s and <code>&gt; 0</code> for <code>contracts</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="mapping"><a class="header" href="#mapping">Mapping</a></h1>
<p>Read about mapping storage here: http://rb.gy/87a8q.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="safeoperations"><a class="header" href="#safeoperations">SafeOperations</a></h1>
<p>A version of <a href="https://github.com/Perelyn-sama/yul_by_example/blob/main/src/Unchecked.sol">Unchecked.sol</a> with overflow checks.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sendether"><a class="header" href="#sendether">SendEther</a></h1>
<p>Sends ether to any address (including <code>address(0)</code>) using <code>call</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="signatureverification"><a class="header" href="#signatureverification">SignatureVerification</a></h1>
<p>Resource: http://rb.gy/akusx.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="simplestorage"><a class="header" href="#simplestorage">SimpleStorage</a></h1>
<p>State variables are stored in locations called <code>slot</code>s. This code writes to a state variable slot using <code>sstore(slot, value)</code>, and reads from that particular slot using <code>sload(slot)</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="structs"><a class="header" href="#structs">Structs</a></h1>
<p>I honestly do not know how to explain what I have written for you to understand 😭. I hope you do.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="types"><a class="header" href="#types">Types</a></h1>
<p>Showcasing the basic types <code>uint</code>, <code>string</code>, <code>address</code>, using Yul.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="unchecked"><a class="header" href="#unchecked">Unchecked</a></h1>
<p>Yul <code>unchecked</code> default math operations.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="yulerc20"><a class="header" href="#yulerc20">YulERC20</a></h1>
<p>A simple implementation of OpenZeppelin's <code>ERC20</code> contract, but with all functionalities written in Yul.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="authors"><a class="header" href="#authors">Authors</a></h1>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script>
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
